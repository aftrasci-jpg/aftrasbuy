<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test PWA - AFTRAS-Buy</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#F28C28">
</head>
<body>
    <header>
        <div class="header-content">
            <a href="index.html" class="back-link">
                <span class="back-icon">‚Üê</span>
                Retour √† AFTRAS-Buy
            </a>
            <div class="site-title">
                <h1>Test PWA</h1>
                <p>Fonctionnalit√©s de l'application</p>
            </div>
        </div>
    </header>

    <main style="max-width: 800px; margin: 2rem auto; padding: 0 2rem;">
        <div style="background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
            <h2 style="color: #004D40; margin-bottom: 2rem; text-align: center;">üîß Test des Fonctionnalit√©s PWA</h2>

            <div id="pwaStatus" style="margin-bottom: 2rem;">
                <h3>üìä Statut PWA</h3>
                <div id="statusContainer"></div>
            </div>

            <div id="installSection" style="margin-bottom: 2rem;">
                <h3>üì± Installation</h3>
                <p>L'app peut √™tre install√©e sur les appareils mobiles et ordinateurs.</p>
                <div id="installStatus"></div>
            </div>

            <div id="cacheSection" style="margin-bottom: 2rem;">
                <h3>üíæ Cache</h3>
                <button onclick="testCache()" style="background: #F28C28; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin-right: 10px;">Tester le Cache</button>
                <button onclick="clearCache()" style="background: #004D40; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Vider le Cache</button>
                <div id="cacheResult" style="margin-top: 10px;"></div>
            </div>

            <div id="notificationSection" style="margin-bottom: 2rem;">
                <h3>üîî Notifications</h3>
                <button onclick="testNotification()" style="background: #F28C28; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin-right: 10px;">Tester Notification</button>
                <button onclick="requestNotificationPermission()" style="background: #004D40; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Demander Permission</button>
                <div id="notificationResult" style="margin-top: 10px;"></div>
            </div>

            <div id="offlineSection">
                <h3>üì∂ Mode Hors Ligne</h3>
                <p>Coupez votre connexion internet et actualisez la page pour tester le mode hors ligne.</p>
                <div id="offlineStatus"></div>
            </div>
        </div>
    </main>

    <script>
        // Test PWA functionality
        document.addEventListener('DOMContentLoaded', () => {
            checkPWAStatus();
            checkInstallStatus();
            checkOfflineStatus();
        });

        function checkPWAStatus() {
            const statusContainer = document.getElementById('statusContainer');
            let status = '';

            // Check Service Worker
            if ('serviceWorker' in navigator) {
                status += '<p>‚úÖ Service Worker: Support√©</p>';
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    if (registrations.length > 0) {
                        status += '<p>‚úÖ Service Worker: Enregistr√©</p>';
                    } else {
                        status += '<p>‚ùå Service Worker: Non enregistr√©</p>';
                    }
                });
            } else {
                status += '<p>‚ùå Service Worker: Non support√©</p>';
            }

            // Check Manifest
            if ('manifest' in document.createElement('link')) {
                status += '<p>‚úÖ Manifest: Support√©</p>';
            } else {
                status += '<p>‚ùå Manifest: Non support√©</p>';
            }

            // Check Web App
            if (window.matchMedia('(display-mode: standalone)').matches) {
                status += '<p>‚úÖ Mode Application: Activ√©</p>';
            } else {
                status += '<p>‚ÑπÔ∏è Mode Application: Navigateur standard</p>';
            }

            statusContainer.innerHTML = status;
        }

        function checkInstallStatus() {
            const installStatus = document.getElementById('installStatus');

            if ('beforeinstallprompt' in window) {
                installStatus.innerHTML = '<p>‚úÖ Installation: Disponible (bouton d\'installation appara√Ætra)</p>';
            } else if (window.matchMedia('(display-mode: standalone)').matches) {
                installStatus.innerHTML = '<p>‚úÖ Installation: App d√©j√† install√©e</p>';
            } else {
                installStatus.innerHTML = '<p>‚ùå Installation: Non disponible sur ce navigateur</p>';
            }
        }

        function checkOfflineStatus() {
            const offlineStatus = document.getElementById('offlineStatus');

            if (!navigator.onLine) {
                offlineStatus.innerHTML = '<p style="color: #F28C28;">üì∂ Vous √™tes actuellement hors ligne. L\'app devrait fonctionner normalement.</p>';
            } else {
                offlineStatus.innerHTML = '<p>üåê Vous √™tes en ligne. Coupez votre connexion pour tester le mode hors ligne.</p>';
            }

            window.addEventListener('online', () => {
                offlineStatus.innerHTML = '<p>üåê Connexion r√©tablie</p>';
            });

            window.addEventListener('offline', () => {
                offlineStatus.innerHTML = '<p style="color: #F28C28;">üì∂ Pass√© hors ligne - testez la navigation</p>';
            });
        }

        async function testCache() {
            const cacheResult = document.getElementById('cacheResult');

            try {
                const cacheNames = await caches.keys();
                cacheResult.innerHTML = `<p>‚úÖ Caches trouv√©s: ${cacheNames.join(', ')}</p>`;

                // Test cache retrieval
                const response = await caches.match('/');
                if (response) {
                    cacheResult.innerHTML += '<p>‚úÖ Page d\'accueil trouv√©e dans le cache</p>';
                } else {
                    cacheResult.innerHTML += '<p>‚ö†Ô∏è Page d\'accueil non trouv√©e dans le cache</p>';
                }
            } catch (error) {
                cacheResult.innerHTML = '<p>‚ùå Erreur lors du test du cache</p>';
            }
        }

        async function clearCache() {
            const cacheResult = document.getElementById('cacheResult');

            try {
                const cacheNames = await caches.keys();
                await Promise.all(
                    cacheNames.map(cacheName => caches.delete(cacheName))
                );
                cacheResult.innerHTML = '<p>‚úÖ Cache vid√© avec succ√®s</p>';
            } catch (error) {
                cacheResult.innerHTML = '<p>‚ùå Erreur lors du vidage du cache</p>';
            }
        }

        function testNotification() {
            const notificationResult = document.getElementById('notificationResult');

            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    new Notification('Test AFTRAS-Buy', {
                        body: 'Ceci est une notification de test !',
                        icon: '/icon.svg',
                        badge: '/icon.svg'
                    });
                    notificationResult.innerHTML = '<p>‚úÖ Notification envoy√©e</p>';
                } else {
                    notificationResult.innerHTML = '<p>‚ö†Ô∏è Permission de notification requise</p>';
                }
            } else {
                notificationResult.innerHTML = '<p>‚ùå Notifications non support√©es</p>';
            }
        }

        async function requestNotificationPermission() {
            const notificationResult = document.getElementById('notificationResult');

            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    notificationResult.innerHTML = '<p>‚úÖ Permission accord√©e</p>';
                } else {
                    notificationResult.innerHTML = '<p>‚ùå Permission refus√©e</p>';
                }
            } else {
                notificationResult.innerHTML = '<p>‚ùå Notifications non support√©es</p>';
            }
        }
    </script>
</body>
</html>
